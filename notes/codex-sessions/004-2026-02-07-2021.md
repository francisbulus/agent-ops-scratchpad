# Codex Session 004 - 2026-02-07 20:21:54Z

## Metadata

- Owner: `francis`
- Title: Create concrete v0 event schema under packages
- Branch: `main`
- HEAD commit at start: `4d5bb63`
- Previous session file: `notes/codex-sessions/003-2026-02-07-2009.md`

## Starting Repo Snapshot

- `?? packages/schemas/`

## Goal

- Produce a concrete `v0` event schema file under `packages/` that covers observability, token usage, cost, budget, and policy primitives.

## Work Log

- Added `packages/schemas/agent-event-v0.schema.json` as JSON Schema draft 2020-12.
- Included strict required base fields: event identity, tenant, run, and trace context.
- Added primitive objects for `step`, `model_call`, `resource_usage`, `cost`, `budget`, `policy`, `alert`, and `error`.
- Added conditional `if/then` requirements keyed by `event_type` (for example, `budget.threshold_hit` requires `budget`).
- Validated syntax with `jq empty packages/schemas/agent-event-v0.schema.json`.

## Decisions

- Chose one canonical event schema file (single envelope) instead of multiple per-event files for MVP speed.
- Used `event_version: "v0"` with strict enums and `additionalProperties: false` for consistency.
- Required `resource_usage` + `cost` for completed/failed run and model-call events to preserve token/cost accountability.

## Open Risks / Blockers

- No blockers for schema authoring.
- Potential integration risk: producers may need transitional mapping to satisfy strict required fields and enums.

## Next Session Must Start With

- Validate this schema against sample payloads from ingest producers.
- Decide whether to relax strictness (`additionalProperties`) in early rollout.
- Wire ingest endpoint validation to this file.

## Handoff Summary

- Created a concrete v0 schema under `packages/schemas` aligned to platform primitives and ready for integration.

## Closeout - 2026-02-07 20:22:15Z

- Summary: Added concrete v0 JSON Schema in packages/schemas for event, usage, cost, budget, policy, alert, and trace primitives.
- Next step for future session: Integrate schema validation into POST /v1/events and test sample payloads.
- Blockers: none
- Branch: `main`
- HEAD at close: `4d5bb63`
